<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>合同对比与风险分析</title>
    <style>
      :root{
        --bg:#0b1220;
        --surface:#0f172a;
        --panel:#0b1220;
        --card:#0b1220;
        --border:rgba(255,255,255,.10);
        --text:#e5e7eb;
        --muted:rgba(229,231,235,.70);
        --accent:#60a5fa;
        --good:#34d399;
        --warn:#fbbf24;
        --bad:#fb7185;
      }
      *{box-sizing:border-box;}
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
        background: radial-gradient(1200px 700px at 20% -10%, rgba(96,165,250,.35), transparent 70%),
                    radial-gradient(900px 600px at 90% 0%, rgba(52,211,153,.20), transparent 60%),
                    var(--bg);
        color:var(--text);
      }
      a{color:inherit;}
      header{
        padding:14px 18px;
        border-bottom:1px solid var(--border);
        background: linear-gradient(180deg, rgba(15,23,42,.85), rgba(15,23,42,.55));
        backdrop-filter: blur(10px);
        position: sticky;
        top: 0;
        z-index: 20;
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:16px;
      }
      .progress{position:absolute;left:0;right:0;bottom:-1px;height:3px;overflow:hidden;display:none;background:rgba(255,255,255,.06);}
      .progress .bar{height:100%;width:40%;background:var(--accent);animation:progress 1.0s ease-in-out infinite;}
      @keyframes progress{0%{transform:translateX(-110%);}100%{transform:translateX(260%);}}
      .brand{display:flex; align-items:center; gap:10px; min-width: 260px;}
      .brand .title{font-weight:700; letter-spacing:.2px;}
      .brand .subtitle{font-size:12px; color:var(--muted); margin-top:2px;}
      .status-pill{
        display:inline-flex;
        align-items:center;
        gap:8px;
        padding:6px 10px;
        border:1px solid var(--border);
        border-radius:999px;
        color:var(--muted);
        font-size:12px;
        background: rgba(15,23,42,.55);
      }
      main{
        display:grid;
        grid-template-columns: 1fr 380px;
        gap:14px;
        padding:14px;
        min-height: calc(100vh - 64px);
      }
      body.risk-collapsed main{ grid-template-columns: 1fr 56px; }
      .left{
        min-width: 0;
      }
      .right{
        min-width: 0;
      }
      .card{
        border:1px solid var(--border);
        border-radius:14px;
        background: linear-gradient(180deg, rgba(15,23,42,.75), rgba(15,23,42,.45));
        box-shadow: 0 12px 30px rgba(0,0,0,.25);
      }
      .card-h{
        padding:12px 14px;
        border-bottom:1px solid var(--border);
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:10px;
      }
      .card-h .h-title{display:flex; align-items:center; gap:10px; font-weight:600;}
      .card-b{padding:12px 14px;}
      .toolbar{
        display:flex;
        gap:10px;
        flex-wrap:wrap;
        align-items:center;
        justify-content:space-between;
      }
      .inputs{
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap:10px;
        width: 100%;
      }
      .file{
        display:flex;
        align-items:center;
        gap:10px;
        padding:10px 12px;
        border-radius:12px;
        border:1px dashed rgba(255,255,255,.18);
        background: rgba(2,6,23,.45);
        cursor:pointer;
        transition: border-color .15s ease, background .15s ease;
        min-width: 0;
      }
      .file:hover{border-color: rgba(96,165,250,.55); background: rgba(2,6,23,.60);}
      .file input{display:none;}
      .file .meta{min-width:0;}
      .file .name{font-size:13px; color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width: 100%;}
      .file .hint{font-size:12px; color:var(--muted); margin-top:2px;}
      .actions{display:flex; gap:8px; align-items:center; justify-content:flex-end;}
      .btn{
        border:1px solid var(--border);
        background: rgba(15,23,42,.55);
        color:var(--text);
        padding:9px 12px;
        border-radius:12px;
        cursor:pointer;
        display:inline-flex;
        align-items:center;
        gap:8px;
        font-weight:600;
        font-size:13px;
        transition: transform .05s ease, background .15s ease;
      }
      .btn:active{transform: translateY(1px);}
      .btn:disabled{opacity:.55; cursor:not-allowed;}
      .btn.primary{background: rgba(96,165,250,.18); border-color: rgba(96,165,250,.35);}
      .btn.primary:hover{background: rgba(96,165,250,.24);}
      .btn.ghost:hover{background: rgba(255,255,255,.06);}
      .toggle{
        display:inline-flex;
        align-items:center;
        gap:10px;
        padding:8px 10px;
        border-radius:12px;
        border:1px solid var(--border);
        background: rgba(2,6,23,.35);
        color:var(--muted);
        user-select:none;
      }
      .toggle input{accent-color: var(--accent);}
      .input{
        display:inline-flex;
        align-items:center;
        gap:10px;
        padding:8px 10px;
        border-radius:12px;
        border:1px solid var(--border);
        background: rgba(2,6,23,.35);
        color:var(--muted);
        user-select:none;
      }
      .input input{
        width:120px;
        padding:6px 8px;
        border-radius:10px;
        border:1px solid rgba(255,255,255,.14);
        background: rgba(15,23,42,.55);
        color: var(--text);
        outline: none;
      }
      .input input::placeholder{color: rgba(229,231,235,.55);}
      .doc-diff{padding: 0;}
      .doc-shell{padding: 12px 14px;}

      .doc-diff { padding: 12px 16px 48px; }
      .diff-grid { display: grid; grid-template-columns: minmax(0,1fr) minmax(0,1fr); gap: 0; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: rgba(2,6,23,.35); }
      .diff-row { display: contents; }
      .diff-cell { padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,.08); }
      .diff-cell.left { border-right: 1px solid rgba(255,255,255,.08); }
      .diff-cell.empty { background: rgba(255,255,255,.03); }
      .diff-row.kind-inserted .diff-cell.right { background: rgba(52,211,153,.10); }
      .diff-row.kind-deleted .diff-cell.left { background: rgba(251,113,133,.10); }
      ins { background: rgba(34,197,94,.32); text-decoration: none; border-bottom: 2px solid rgba(34,197,94,.85); border-radius: 4px; padding: 0 1px; }
      del { background: rgba(239,68,68,.30); text-decoration: line-through; border-bottom: 2px solid rgba(239,68,68,.65); border-radius: 4px; padding: 0 1px; }
      .diff-cell.active-diff-cell{outline:2px solid rgba(96,165,250,.65); outline-offset:-2px;}
      .diff-cell{overflow-wrap:break-word; word-break:normal; min-width: 0;}
      .cell-inner{display:flex; align-items:flex-start; gap:8px;}
      .ai-suggest-btn{
        flex: 0 0 auto;
        width: 28px;
        height: 28px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,.10);
        background: rgba(15,23,42,.40);
        color: rgba(229,231,235,.85);
        cursor: pointer;
        display:inline-flex;
        align-items:center;
        justify-content:center;
        margin-top: 2px;
      }
      .ai-suggest-btn:hover{background: rgba(255,255,255,.06);}
      .cell-content{min-width:0; flex: 1;}
      .diff-cell p, .diff-cell h1, .diff-cell h2, .diff-cell h3, .diff-cell h4, .diff-cell h5, .diff-cell h6{margin:.25em 0;}
      .diff-cell ul, .diff-cell ol{margin:.25em 0; padding-left:1.1em; list-style-position: inside;}
      .diff-cell li{margin:.1em 0;}
      .diff-cell table{border-collapse:collapse; width:100%;}
      .diff-cell td, .diff-cell th{border:1px solid rgba(255,255,255,.18); padding:4px 6px; vertical-align:top;}
      .diff-cell table p{margin:.15em 0;}
      .diff-cell u{text-decoration: underline; text-decoration-thickness: 1px; text-decoration-skip-ink: none;}
      .diff-only .diff-row.kind-matched{display:none;}
      #rulesTemplatePreview table{border-collapse:collapse; width:100%;}
      #rulesTemplatePreview td, #rulesTemplatePreview th{border:1px solid rgba(255,255,255,.18); padding:4px 6px; vertical-align:top;}
      #rulesTemplatePreview table p{margin:.15em 0;}

      .tip { border: 1px solid rgba(96,165,250,.35); border-radius: 12px; padding: 10px 12px; margin-bottom: 10px; background: rgba(96,165,250,.10); font-size: 12px; color: rgba(229,231,235,.92); line-height: 1.4; }
      .risk-item { border: 1px solid var(--border); border-radius: 12px; padding: 10px 12px; margin-bottom: 10px; background: rgba(2,6,23,.25); }
      .risk-item .meta { color: var(--muted); font-size: 12px; margin-top: 6px; }
      .risk-item[data-level="high"] { border-color: rgba(251,113,133,.55); }
      .risk-item[data-level="medium"] { border-color: rgba(251,191,36,.55); }
      .risk-item[data-level="low"] { border-color: rgba(52,211,153,.45); }
      .risk-head { display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
      .risk-title { font-weight: 700; display:flex; align-items:center; gap:8px; min-width: 0; }
      .risk-title .t { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .risk-actions { display:flex; gap:8px; align-items:center; flex-shrink: 0; }
      .risk-toggle { width: 30px; height: 30px; border-radius: 10px; border: 1px solid rgba(255,255,255,.10); background: rgba(15,23,42,.40); color: rgba(229,231,235,.85); cursor: pointer; display:inline-flex; align-items:center; justify-content:center; }
      .risk-item.expanded .risk-toggle { background: rgba(15,23,42,.60); }
      .risk-item.expanded .risk-toggle svg { transform: rotate(90deg); }
      .risk-toggle svg { transition: transform .12s ease; }
      .mini-btn { height: 30px; padding: 0 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,.10); background: rgba(15,23,42,.40); color: rgba(229,231,235,.85); cursor: pointer; font-weight: 600; font-size: 12px; }
      .mini-btn:hover { background: rgba(255,255,255,.06); }
      .risk-summary { margin-top: 8px; }
      .risk-body { margin-top: 10px; border-top: 1px solid rgba(255,255,255,.08); padding-top: 10px; }
      .risk-body .k { color: rgba(229,231,235,.85); font-weight: 700; font-size: 12px; margin-top: 10px; }
      .risk-body .k:first-child { margin-top: 0; }
      .risk-body ul { margin: 6px 0 0; padding-left: 18px; }
      .risk-body li { margin: 4px 0; color: rgba(229,231,235,.92); }
      .risk-card.collapsed .card-b { display: none; }
      body.risk-collapsed .risk-card .card-h { flex-direction: column; align-items: center; justify-content: center; gap: 8px; }
      body.risk-collapsed .risk-card .h-title span { display: none; }
      body.risk-collapsed .risk-card #riskMeta { display: none; }
      .icon{width:16px;height:16px;display:inline-block;vertical-align:middle;fill:currentColor;opacity:.9;}
      .mono{font-variant-numeric: tabular-nums;}

      .modal{position:fixed; inset:0; z-index: 50; display:none;}
      .modal.open{display:block;}
      .modal-backdrop{position:absolute; inset:0; background: rgba(0,0,0,.55);}
      .modal-card{
        position:absolute;
        left:50%;
        top:50%;
        transform: translate(-50%, -50%);
        width: min(860px, calc(100vw - 24px));
        max-height: min(80vh, 720px);
        overflow:auto;
        border:1px solid var(--border);
        border-radius:14px;
        background: linear-gradient(180deg, rgba(15,23,42,.92), rgba(15,23,42,.72));
        box-shadow: 0 18px 60px rgba(0,0,0,.45);
      }
      #rulesModal .modal-card{
        width: min(1400px, calc(100vw - 24px));
        max-height: min(88vh, 880px);
      }
      .modal-h{padding:12px 14px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; gap:10px;}
      .modal-b{padding:12px 14px;}
      .modal-title{font-weight:700;}
      .modal-pre{white-space:pre-wrap; line-height:1.5; color: rgba(229,231,235,.92);}
    </style>
  </head>
  <body>
    <header>
      <div class="brand">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2h7l5 5v15a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm7 1.5V8h4.5L14 3.5zM8 12h8v1.5H8V12zm0 4h8v1.5H8V16zm0-8h5v1.5H8V8z"/></svg>
        <div>
          <div class="title">合同对比与风险分析</div>
          <div class="subtitle">块级对齐 · 差异高亮 · 异步风险建议 · 可导出 PDF</div>
        </div>
      </div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button class="btn ghost" id="rulesBtn" type="button">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a5 5 0 0 1 5 5v1h1a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-1v3h1a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-1v1a5 5 0 0 1-10 0v-1H6a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h1v-3H6a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2h1V7a5 5 0 0 1 5-5zm-3 6h6V7a3 3 0 0 0-6 0v1zm8 4v-2H7v2h10zm0 8v-2H7v2h10zm-8-3h6v-3H9v3z"/></svg>
          配置
        </button>
        <div class="status-pill mono" id="status"></div>
      </div>
      <div class="progress" id="progress"><div class="bar"></div></div>
    </header>
    <main>
      <section class="left">
        <div class="card">
          <div class="card-h">
            <div class="h-title">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a7 7 0 0 1 7 7v1h1a2 2 0 0 1 2 2v6a4 4 0 0 1-4 4H8a6 6 0 0 1 0-12h1V9a7 7 0 0 1 7-7zm-5 12a4 4 0 1 0 0 8h10a2 2 0 0 0 2-2v-6H7zm5-10a5 5 0 0 0-5 5v1h10V9a5 5 0 0 0-5-5z"/></svg>
              <span>上传并对比</span>
            </div>
            <div class="actions">
              <label class="toggle">
                <input type="checkbox" id="aiMode" checked />
                <span>AI</span>
              </label>
              <button class="btn ghost" id="resetBtn" type="button">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 6V3L8 7l4 4V8a4 4 0 1 1-4 4H6a6 6 0 1 0 6-6z"/></svg>
                重置
              </button>
              <button class="btn primary" id="submitBtn" type="submit" form="form">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12h6l-2 2 1.4 1.4L13.8 10 8.4 4.6 7 6l2 2H3v4zm18-8H11v2h10v12H11v2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/></svg>
                开始对比
              </button>
            </div>
          </div>
          <div class="card-b">
            <form id="form">
              <div class="inputs">
                <label class="file">
                  <input id="leftFile" type="file" name="leftFile" accept=".doc,.docx,.pdf" />
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l2 2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2z"/></svg>
                  <div class="meta">
                    <div class="name" id="leftName">标准合同（请先选择）</div>
                    <div class="hint">左栏为标准合同或修订前合同</div>
                    <div style="margin-top:10px;">
                      <div class="meta" style="opacity:.78; margin-bottom:6px;">文档类型</div>
                      <select id="standardType" style="height:32px; width:100%; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 10px;">
                        <option value="" selected>加载中…</option>
                      </select>
                    </div>
                  </div>
                </label>
                <label class="file">
                  <input id="rightFile" type="file" name="rightFile" accept=".doc,.docx,.pdf" required />
                  <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l2 2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2z"/></svg>
                  <div class="meta">
                    <div class="name" id="rightName">待审合同（点击选择 .doc/.docx）</div>
                    <div class="hint">右栏为待审合同或修订后合同</div>
                  </div>
                </label>
              </div>
              <div style="margin-top:10px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <label class="toggle">
                  <input type="checkbox" id="ignoreSectionNumber" name="ignoreSectionNumber" checked />
                  <span>忽略章节号</span>
                </label>
                <label class="toggle">
                  <span>分段规则</span>
                  <select id="chunkLevel" name="chunkLevel" style="height:30px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 8px;">
                    <option value="1">一级章节</option>
                    <option value="2" selected>二级章节</option>
                  </select>
                </label>
              </div>
            </form>
          </div>
        </div>

        <div style="height:12px;"></div>

        <div class="card doc-diff">
          <div class="card-h">
            <div class="h-title">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 4h16v2H4V4zm0 14h16v2H4v-2zm0-7h16v2H4v-2z"/></svg>
              <span>对比结果</span>
            </div>
            <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
              <label class="toggle">
                <input type="checkbox" id="diffOnly" />
                <span>只显示差异</span>
              </label>
              <button class="btn ghost" id="prevDiffBtn" type="button" disabled>
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M15.4 7.4L14 6l-6 6 6 6 1.4-1.4L10.8 12l4.6-4.6z"/></svg>
                上一处
              </button>
              <button class="btn ghost" id="nextDiffBtn" type="button" disabled>
                下一处
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.6 16.6L10 18l6-6-6-6-1.4 1.4L13.2 12l-4.6 4.6z"/></svg>
              </button>
              <button class="btn ghost" id="topBtn" type="button" disabled>
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 8l6 6-1.4 1.4L12 10.8 7.4 15.4 6 14l6-6z"/></svg>
                顶部
              </button>
              <button class="btn ghost" id="exportBtn" type="button" disabled>
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 16l4-5h-3V4h-2v7H8l4 5zm8 2v2H4v-2h16z"/></svg>
                导出 PDF
              </button>
              <a class="btn ghost" id="pdfLink" href="#" style="display:none;" target="_blank" rel="noreferrer">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8l-5-6zm1 7V3.5L18.5 9H15zM8 13h8v1.5H8V13zm0 3h8v1.5H8V16z"/></svg>
                下载 PDF
              </a>
              <div class="status-pill mono" id="diffNavMeta"></div>
              <div class="status-pill mono" id="compareMeta"></div>
            </div>
          </div>
          <div class="doc-shell" id="result"></div>
        </div>
      </section>

      <aside class="right">
        <div class="card risk-card collapsed" id="confirmCard" style="display:none;">
          <div class="card-h">
            <div class="h-title">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M9 16.2l-3.5-3.5L4 14.2l5 5 11-11-1.5-1.5z"/></svg>
              <span>标准确认</span>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
              <button class="mini-btn" id="confirmAreaToggle" type="button" aria-expanded="false">展开</button>
              <div class="status-pill mono" id="confirmMeta"></div>
            </div>
          </div>
          <div class="card-b">
            <div id="confirmTip" class="tip" style="display:none;"></div>
            <div id="confirmList"></div>
          </div>
        </div>
        <div class="card risk-card collapsed" id="riskCard">
          <div class="card-h">
            <div class="h-title">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20zm1-5v-2h-2v2h2zm0-4V7h-2v6h2z"/></svg>
              <span>风险建议</span>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
              <button class="mini-btn" id="riskAreaToggle" type="button" aria-expanded="false">展开</button>
              <div class="status-pill mono" id="riskMeta"></div>
            </div>
          </div>
          <div class="card-b">
            <div id="sectionTip" class="tip" style="display:none;"></div>
            <div id="risks"></div>
          </div>
        </div>
      </aside>
    </main>
    <div class="modal" id="aiModal" aria-hidden="true">
      <div class="modal-backdrop" id="aiModalBackdrop"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="aiModalTitle">
        <div class="modal-h">
          <div class="modal-title" id="aiModalTitle">AI 差异解析</div>
          <button class="mini-btn" id="aiModalClose" type="button">关闭</button>
        </div>
        <div class="modal-b">
          <div class="modal-pre" id="aiModalContent"></div>
        </div>
      </div>
    </div>
    <div class="modal" id="rulesModal" aria-hidden="true">
      <div class="modal-backdrop" id="rulesModalBackdrop"></div>
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="rulesModalTitle">
        <div class="modal-h">
          <div class="modal-title" id="rulesModalTitle">标准合同审查规则配置</div>
          <button class="mini-btn" id="rulesModalClose" type="button">关闭</button>
        </div>
        <div class="modal-b">
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px;">
            <label class="toggle">
              <span>标准合同</span>
              <select id="rulesStandardType" style="height:30px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 8px; min-width: 200px;">
                <option value="" selected>加载中…</option>
              </select>
            </label>
            <label class="file" style="flex: 1; min-width: 280px; max-width: 520px;">
              <input id="rulesTemplateFile" type="file" accept=".doc,.docx,.pdf" />
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l2 2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2z"/></svg>
              <div class="meta">
                <div class="name" id="rulesTemplateName">上传标准合同模板（.doc/.docx/.pdf）</div>
                <div class="hint">保存到服务端的标准合同目录</div>
              </div>
            </label>
            <button class="btn ghost" id="rulesTemplateUploadBtn" type="button">上传模板</button>
            <button class="btn ghost" id="rulesLoadBtn" type="button">加载</button>
            <button class="btn primary" id="rulesSaveBtn" type="button">保存</button>
            <div class="status-pill mono" id="rulesStatus"></div>
          </div>
          <div style="display:flex; gap:12px; align-items:stretch; flex-wrap:wrap;">
            <div style="flex:1; min-width:320px; max-width: 680px;">
              <div class="status-pill mono" id="rulesAnchorBar" style="display:none; margin-bottom:10px;"></div>
              <div id="rulesTemplatePreview" style="width:100%; min-height:360px; max-height:60vh; overflow:auto; border-radius:12px; border:1px solid rgba(255,255,255,.14); background: rgba(2,6,23,.20); padding: 10px 12px;"></div>
            </div>
            <div id="rulesForm" style="flex:1; min-width:360px; min-height:360px; max-height:60vh; overflow:auto; border-radius:12px; border:1px solid rgba(255,255,255,.14); background: rgba(2,6,23,.35); color: var(--text); padding: 10px 12px; outline: none; line-height: 1.5;">
              <div class="status-pill mono" style="margin-bottom:10px; opacity:.9;">右侧填写规则，保存时自动生成 JSON</div>
              <div style="display:flex; flex-direction:column; gap:12px;">
                <div style="border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:10px 12px; background: rgba(15,23,42,.28);">
                  <div style="font-weight:700; margin-bottom:10px;">通用规则</div>
                  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <label class="toggle" style="justify-content:flex-start;">
                      <input type="checkbox" id="rulesHeadingEnabled" checked />
                      <span>标题存在检查</span>
                    </label>
                    <label class="toggle" style="justify-content:flex-start;">
                      <span>标题层级</span>
                      <input id="rulesHeadingMaxLevel" type="number" min="1" max="6" step="1" value="2" style="height:30px; width: 90px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 8px; outline:none;" />
                    </label>
                    <label class="toggle" style="justify-content:flex-start;">
                      <input type="checkbox" id="rulesPlaceholderEnabled" checked />
                      <span>占位符填写检查</span>
                    </label>
                    <label class="toggle" style="justify-content:flex-start;">
                      <input type="checkbox" id="rulesDeletedEnabled" checked />
                      <span>模板条款缺失提醒</span>
                    </label>
                    <div style="grid-column: 1 / -1;">
                      <div class="meta" style="opacity:.85; margin-bottom:6px;">占位符正则（可选）</div>
                      <input id="rulesPlaceholderRegex" type="text" placeholder="留空使用默认规则" style="height:32px; width:100%; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 10px; outline:none;" />
                    </div>
                  </div>
                </div>

                <div id="rulesPurchaseSection" style="border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:10px 12px; background: rgba(15,23,42,.28);">
                  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px;">
                    <div style="font-weight:700;">买卖合同（采购）</div>
                    <label class="toggle" style="justify-content:flex-start;">
                      <input type="checkbox" id="rulesPurchaseEnabled" checked />
                      <span>启用</span>
                    </label>
                  </div>
                  <div style="display:flex; flex-direction:column; gap:10px;">
                    <div style="display:grid; grid-template-columns: 180px 1fr; gap:10px; align-items:center;">
                      <label class="toggle" style="justify-content:flex-start;">
                        <input type="checkbox" id="rulesPurchaseSigningEnabled" checked />
                        <span>签订日期</span>
                      </label>
                      <label class="toggle" style="justify-content:flex-start;">
                        <span>精度</span>
                        <select id="rulesPurchaseSigningMinPrecision" style="height:30px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 8px; outline:none; min-width: 150px;">
                          <option value="month" selected>至少到月</option>
                          <option value="day">至少到日</option>
                        </select>
                      </label>
                    </div>

                    <div style="display:grid; grid-template-columns: 180px 1fr; gap:10px; align-items:center;">
                      <label class="toggle" style="justify-content:flex-start;">
                        <input type="checkbox" id="rulesPurchaseBuyerEnabled" checked />
                        <span>买方名称</span>
                      </label>
                      <label class="toggle" style="justify-content:flex-start;">
                        <span>公司后缀</span>
                        <input id="rulesPurchaseBuyerSuffix" type="text" value="公司" style="height:30px; width: 160px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 8px; outline:none;" />
                      </label>
                    </div>

                    <div style="border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:10px 10px; background: rgba(2,6,23,.22);">
                      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;">
                        <label class="toggle" style="justify-content:flex-start;">
                          <input type="checkbox" id="rulesPurchaseSection1Enabled" checked />
                          <span>一：标的与金额信息</span>
                        </label>
                        <label class="toggle" style="justify-content:flex-start;">
                          <input type="checkbox" id="rulesPurchaseSection1UpperLower" checked />
                          <span>要求金额大小写</span>
                        </label>
                      </div>
                      <div class="meta" style="opacity:.85; margin-bottom:6px;">必填字段（逗号分隔）</div>
                      <input id="rulesPurchaseSection1Keywords" type="text" value="产品名称,单价,数量,总价,合计金额" style="height:32px; width:100%; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 10px; outline:none;" />
                    </div>

                    <div style="border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:10px 10px; background: rgba(2,6,23,.22);">
                      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;">
                        <label class="toggle" style="justify-content:flex-start;">
                          <input type="checkbox" id="rulesPurchaseDeliveryAddressEnabled" checked />
                          <span>二/2：交货地址与联系人</span>
                        </label>
                      </div>
                      <div class="meta" style="opacity:.85; margin-bottom:6px;">必填字段（逗号分隔）</div>
                      <input id="rulesPurchaseDeliveryKeywords" type="text" value="交货地址,联系人" style="height:32px; width:100%; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 10px; outline:none;" />
                    </div>

                    <div style="display:grid; grid-template-columns: 180px 1fr; gap:10px; align-items:center;">
                      <label class="toggle" style="justify-content:flex-start;">
                        <input type="checkbox" id="rulesPurchaseDeliveryDateEnabled" checked />
                        <span>二/3：交货日期</span>
                      </label>
                      <label class="toggle" style="justify-content:flex-start;">
                        <span>精度</span>
                        <select id="rulesPurchaseDeliveryMinPrecision" style="height:30px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 8px; outline:none; min-width: 150px;">
                          <option value="month" selected>至少到月</option>
                          <option value="day">至少到日</option>
                        </select>
                      </label>
                    </div>

                    <div style="display:grid; grid-template-columns: 180px 1fr; gap:10px; align-items:center;">
                      <label class="toggle" style="justify-content:flex-start;">
                        <input type="checkbox" id="rulesPurchaseEndUserEnabled" checked />
                        <span>二/4：最终用户名称</span>
                      </label>
                      <label class="toggle" style="justify-content:flex-start;">
                        <span>公司后缀</span>
                        <input id="rulesPurchaseEndUserSuffix" type="text" value="公司" style="height:30px; width: 160px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 8px; outline:none;" />
                      </label>
                    </div>

                    <div style="border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:10px 10px; background: rgba(2,6,23,.22);">
                      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;">
                        <label class="toggle" style="justify-content:flex-start;">
                          <input type="checkbox" id="rulesPurchaseSection4Enabled" checked />
                          <span>四/1：日期与金额</span>
                        </label>
                        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
                          <label class="toggle" style="justify-content:flex-start;">
                            <input type="checkbox" id="rulesPurchaseSection4Currency" checked />
                            <span>要求货币单位</span>
                          </label>
                          <label class="toggle" style="justify-content:flex-start;">
                            <input type="checkbox" id="rulesPurchaseSection4UpperLower" checked />
                            <span>要求金额大小写</span>
                          </label>
                        </div>
                      </div>
                    </div>

                    <div style="display:grid; grid-template-columns: 180px 1fr; gap:10px; align-items:center;">
                      <label class="toggle" style="justify-content:flex-start;">
                        <input type="checkbox" id="rulesPurchaseTermMaxEnabled" checked />
                        <span>五/3：期限上限</span>
                      </label>
                      <label class="toggle" style="justify-content:flex-start;">
                        <span>最大值</span>
                        <input id="rulesPurchaseTermMax" type="number" min="1" step="1" value="10" style="height:30px; width: 120px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(15,23,42,.55); color: var(--text); padding: 0 8px; outline:none;" />
                      </label>
                    </div>

                    <div style="display:grid; grid-template-columns: 180px 1fr; gap:10px; align-items:center;">
                      <label class="toggle" style="justify-content:flex-start;">
                        <input type="checkbox" id="rulesPurchaseSection8Enabled" checked />
                        <span>八/1：期限</span>
                      </label>
                      <div class="meta" style="opacity:.75;">未稳定定位时将提示人工复核</div>
                    </div>

                    <div style="display:grid; grid-template-columns: 180px 1fr; gap:10px; align-items:center;">
                      <label class="toggle" style="justify-content:flex-start;">
                        <input type="checkbox" id="rulesPurchaseCopiesEnabled" checked />
                        <span>十九/3：份数</span>
                      </label>
                      <div class="meta" style="opacity:.75;">识别到“份数/份”数值则通过</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="/app.js"></script>
  </body>
</html>
