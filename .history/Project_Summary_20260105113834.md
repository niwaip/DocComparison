# 项目概要：AI 驱动的合同差异分析与风险评估工具

## 1. 项目目的

本项目旨在开发一个智能合同分析工具，帮助法务、商务及管理人员快速识别和评估两个不同版本合同文件之间的差异，并由 AI 提供专业的风险分析和建议。该工具的核心特点是能够在比对过程中保留原始文档的版式和样式，提供直观、易于理解的比对结果，从而大幅提升合同审查的效率和准确性，降低潜在的商业和法律风险。

## 2. 核心功能

*   **双文件上传**：提供一个简洁的用户界面，支持用户同时上传两个版本的合同文件。
*   **样式保持比对**：在后端将文档转换为保留样式的 HTML 格式，并在此基础上进行差异比对。最终在前端生成一个保留了原文档大部分样式（如标题、列表、表格、加粗等）的差异视图。
*   **可视化差异高亮**：在比对视图中，使用直观的颜色和标记（例如，绿色背景表示新增，红色删除线表示删除）来高亮显示文本和格式的变更。
*   **AI 风险洞察**：自动将存在差异的条款发送给大型语言模型（LLM），由 AI 模拟法务专家的视角，对变更内容进行风险分析，并提供具体的应对建议。
*   **一体化视图**：将可视化差异比对结果与 AI 生成的风险建议并排或集成展示，方便用户一站式完成审查工作。

## 3. 技术架构与选型

### 3.1. 总体流程

项目的核心处理流程如下：
**`用户上传 .docx` -> `后端转换为 HTML` -> `后端比对生成 Diff HTML` -> `后端调用 AI 分析` -> `前端渲染最终 HTML 和 AI 建议`**

### 3.2. 前端 (Frontend)

*   **框架**: 建议使用 **React** 或 **Vue**，基于项目现有技术栈决定。
*   **核心任务**:
    *   构建文件上传组件。
    *   使用 `axios` 或 `fetch` 将文件发送到后端。
    *   接收后端返回的完整 HTML 比对结果，并直接将其渲染到页面中（使用 `dangerouslySetInnerHTML` 或等效方法）。
    *   编写简单的 CSS 规则来定义差异标签（`<ins>`, `<del>`）的显示样式（如颜色、背景、删除线等）。
    *   展示由后端返回的 AI 风险分析结果。

### 3.3. 后端 (Backend)

*   **框架**: 建议使用 **Node.js + Express** 或 **Python + FastAPI**，以提供高效的 I/O 和 API 服务。
*   **技术选型**:
    *   **文档到 HTML 转换**:
        *   **(初期 .docx 处理)**: 使用 `mammoth.js` (Node.js) 或 `pypandoc` (Python) 库，这两个库都能很好地将 `.docx` 文件转换为干净的 HTML。
    *   **HTML 差异比对**:
        *   使用 `htmldiff.js` 或类似的库，它能够比较两个 HTML 字符串并生成一个包含 `<ins>` 和 `<del>` 标签的合并后 HTML。
    *   **API 设计**:
        *   设计一个主 API 端点 `/api/compare`，接收 `multipart/form-data` 格式的两个文件。
        *   返回一个 JSON 对象，其中包含 `diffHtml` (比对结果的 HTML 字符串) 和 `aiSuggestions` (AI 分析结果)。

### 3.4. AI 集成 (AI Integration)

*   **模型**: 调用一个强大的大型语言模型（如 Google Gemini, OpenAI GPT 等）。
*   **Prompt 工程**: 设计一个结构化的 Prompt，将带有差异标签的 HTML 片段传递给模型，并明确指示其扮演法务专家的角色，分析风险并给出建议。

## 4. 初期开发范围 (MVP)

*   **专注 `.docx` 文件**: 第一阶段的开发将完全集中在对 `.docx` 文件的处理上。
*   **完成核心流程**: 实现从文件上传、后端处理（HTML 转换、比对、AI 分析）到前端展示的完整工作流。
*   **基本 UI**: 搭建功能性的前端页面，确保用户可以顺利完成一次比对和分析任务。

## 5. 扩展性设计

为了确保项目未来的可扩展性，后端架构将采用模块化设计。

*   **文档处理服务化**: 创建一个“文档解析器 (Document Parser)”模块。该模块将根据文件类型（通过文件扩展名或 MIME 类型判断）调用不同的解析策略。
*   **初期策略**: 内置一个 `DocxParser`，负责调用 `mammoth.js` 等库处理 `.docx` 文件。
*   **未来扩展 (.pdf)**: 当需要支持 PDF 时，我们只需在该模块中新增一个 `PdfParser`。这个新的解析器将负责调用您提到的 `mineruapi`。核心的比对、AI 分析和前端逻辑**无需任何更改**，只需将 `PdfParser` 的输出（HTML）接入后续流程即可。这种设计将极大降低未来新格式支持的开发成本。

---
*该文档由 AI 助手生成，旨在作为项目启动的初步规划。*
